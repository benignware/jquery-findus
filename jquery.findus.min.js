/*! jquery-findus 05-07-2015 */
!function(a){function b(b,c){function g(a){w.resize()}function h(a){o=q.getCenter()}function i(a){if(c.content||c.address){var b=s.getMap();b?s.close():s.open(q,r)}}function j(){s.close()}function k(){var d=a.extend(!0,{},c.marker,{map:q,position:o}),e=r&&r.getPosition()||null;r?r.setOptions(d):(r=new google.maps.Marker(d),google.maps.event.addListener(r,"click",i)),l(),clearTimeout(t),!c.autoShow||s.getMap()||e&&(e.lat()===o.lat()||e.lng()===o.lng())||(t=setTimeout(function(){s.open(q,r),a(b).find('img[src*="gstatic.com/"], img[src*="googleapis.com/"]').css("max-width","none"),r.setAnimation(null)},r.getAnimation()?700:350))}function l(){console.log("update info window");var b=a.extend(!0,{},c.info,{content:c.content||c.address&&a.trim(c.address).split(",").join("<br/>")||function(a,b){return e[a+","+b]?e[a+","+b][0].formatted_address.split(",").join("<br/>"):void 0}(c.latitude,c.longitude)});s?s.setOptions(b):s=new google.maps.InfoWindow(b)}function m(){if(console.log("update map"),o){var d=a.extend(!0,{},c.map,{center:o});console.log("mapOptions: ",d),q?q.setOptions(d):(n(),q=new google.maps.Map(b,d),google.maps.event.addListener(q,"click",j)),google.maps.event.addListenerOnce(q,"tilesloaded",function(){k()})}}function n(){"function"==typeof c.minHeight?c.minHeight.call(this,c):c.minHeight,"function"==typeof c.maxHeight?c.maxHeight.call(this,c):c.maxHeight;a(b).css("min-height",c.minHeight||""),a(b).css("max-height",c.maxHeight||"")}google&&google.maps||console.warn("jquery-findus needs Google Maps API");var o,p,q,r,s,t,u,v={address:"",autoShow:!0,bindResize:!0,content:"",info:{},map:{zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,draggable:!1,zoomControl:!1,scrollwheel:!1,disableDoubleClickZoom:!0},marker:{},minWidth:0,minHeight:440},w=this,x=a(b);this.refresh=function(){if(google.maps.Geocoder&&google.maps.LatLng){if(u=u||new google.maps.Geocoder,c.latitude&&c.longitude)o=new google.maps.LatLng(c.latitude,c.longitude),c.content&&c.address?m():u.geocode({latLng:o},function(a,b){b===google.maps.GeocoderStatus.OK?(e[c.latitude+","+c.longitude]=a,m()):console.warn("Geocoder returned with error: ",b)});else if(c.content||c.address){var b=a.map((c.address||c.content&&function(b){return b.match(/<address/)&&a("<div>"+b+"</div>").find("address").html()||b}(c.content)).split(/<(?:.|\n)*?>/gm),function(b){var c=a.trim(b);return c||null}).join(",");d[b]?(o=d[b][0].geometry.location,m()):u.geocode({address:b},function(a,c){c===google.maps.GeocoderStatus.OK?(d[b]=a,o=d[b][0].geometry.location,m()):console.warn("Geocoder returned with error '"+c+"' for string '"+b+"'")})}this.resize()}},this.setOptions=function(b){c=a.extend({},c,b),this.refresh()},this.getOptions=function(){return a.extend({},c)},this.resize=function(){var a=this.getOptions();(a.latitude&&a.longitude||a.address||a.content)&&n(),q&&(console.log("resize map"),google.maps.event.clearListeners(q,"center_changed"),window.clearTimeout(p),p=window.setTimeout(function(){q.setCenter(o),google.maps.event.addListener(q,"center_changed",h)},0),google.maps.event.trigger(q,"resize"))},c=a.extend(!0,{},v,c,{content:x.html().replace(/^\s+|\s+$/g,"")},f(x.data(),["map","marker","info"])),console.log("options: ",x.data(),f(x.data(),["map","marker","info"])),x.html(""),a(window).off("resize",g),c.bindResize&&a(window).on("resize",g),this.refresh()}var c="findus",d={},e={},f=function(a,b){var c,d,e,f;for(c in a)for(d=0;d<b.length;d++)e=b[d],c.substring(0,e.length)===e&&c.length>e.length&&(f=c.substring(e.length,e.length+1).toLowerCase()+c.substring(e.length+1),a[e]=a[e]||{},a[e][f]=a[c],delete a[c]);return a};jQuery.fn[c]=function(d){return this.each(function(){var e=a(this).data(c);return e?e.setOptions(d):e=a(this).data(c,new b(this,d)),a(this)})},a(document).on("show.bs.tab show.bs.modal show.bs.collapse",function(b){var d,e=a(b.target);e=a(e.attr("data-target")||(d=e.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,"")||b.target),e.css("display","block").find("*").map(function(){return a(this).data(c)||null}).each(function(){this.resize()}),e.css("display","")})}(jQuery);